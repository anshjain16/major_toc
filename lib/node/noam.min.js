(t=>{"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=t),"undefined"!=typeof exports&&"function"!=typeof exports&&(exports.noam=t),"function"==typeof define&&define.amd&&define("noam",[],function(){return t}),"undefined"!=typeof window&&(window.noam=t)})((()=>{var l,o,c,a,r,n,s,u,t,T={};function e(){return this.value++}function f(t,e){for(var n in t)t.hasOwnProperty(n)&&delete t[n];for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function h(t,e){var n=e.get(t);return n||(n=T.fsm.minimize(T.re.tree.toAutomaton(t)),e.put(t,n)),n}function m(t){return{tag:l.ALT,choices:t}}function p(t){return{tag:l.SEQ,elements:t}}function g(t){return{tag:l.KSTAR,expr:t}}function S(t){return{tag:l.LIT,obj:t}}function d(){return c}function b(t,e,n){return a[t.tag](t,e,n)}function v(t,e,n){t=r[t.tag]>=r[e.tag];t&&n.push(T.re.array.specials.LEFT_PAREN),E(e,n),t&&n.push(T.re.array.specials.RIGHT_PAREN)}function y(t,e,n,a){for(var i=0;i<n.length;i++)void 0!==a&&0<i&&e.push(a),v(t,n[i],e)}function E(t,e){n[t.tag](t,e)}function A(t){var e=[];return E(t,e),e}function w(t,e,n,a,i){t=((t,e,n,a,i)=>{var r,s;return 0===t?c:1==t?S(e[T.util.randint(0,e.length-1)]):Math.random()<=i?m([c,w(t,e,n,a,i)]):(r=T.util.randint(1,t-1),s=w(r,e,n,a,i),t=w(t-r,e,n,a,i),(Math.random()<=n?m:p)([s,t]))})(t,e,n,a,i);return t=Math.random()<=a?g(t):t}function x(t,e){this.name="RegexError",this.message=t,this.position=e}function L(){return this.arr[this.idx]}function R(){++this.idx}function k(t){for(var e=[];e.push((t=>{for(var e,n=[];void 0!==(e=(t=>{var e=(t=>{if(t.peek()===s.LEFT_PAREN){t.advance();var e=k(t);if(t.peek()!==s.RIGHT_PAREN)throw new x("Malformed regex array: missing matching right parenthesis at index "+t.idx,t.idx);return t.advance(),e}if(t.peek()===s.EPS)return t.advance(),T.re.tree.makeEps();if(void 0!==t.peek()&&t.peek()!==s.ALT&&t.peek()!==s.RIGHT_PAREN){if(t.peek()===s.KSTAR)throw new x("Malformed regex array: empty subexpression before Kleene star at index "+t.idx,t.idx);return e=T.re.tree.makeLit(t.peek()),t.advance(),e}})(t);return t.peek()===s.KSTAR&&(t.advance(),e=T.re.tree.makeKStar(e)),e})(t));)n.push(e);if(0!==n.length)return T.re.tree.makeSeq(n);throw new x("Malformed regex array: empty choice subexpression at index "+t.idx,t.idx)})(t)),t.peek()===s.ALT;)t.advance();return T.re.tree.makeAlt(e)}return T.util={},T.util.areEquivalent=function(t,e){if(t!==e){if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof RegExp&&e instanceof RegExp)return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(!(t instanceof Object&&e instanceof Object))return!1;if(void 0===t||void 0===e)return!1;if(t.constructor!==e.constructor)return!1;for(var n in t){if(!(n in e))return!1;if(t[n]!==e[n]){if("object"!=typeof t[n])return!1;if(!T.util.areEquivalent(t[n],e[n]))return!1}}for(n in e)if(!(n in t))return!1}return!0},T.util.contains=function(t,e,n){for(var a=n=n||0;a<t.length;a++)if(T.util.areEquivalent(t[a],e))return!0;return!1},T.util.index=function(t,e,n){for(var a=n||0;a<t.length;){if(T.util.areEquivalent(t[a],e))return a;a++}return-1},T.util.containsAll=function(t,e){for(var n=0;n<e.length;n++)if(!T.util.contains(t,e[n]))return!1;return!0},T.util.containsAny=function(t,e){for(var n=0;n<e.length;n++)if(T.util.contains(t,e[n]))return!0;return!1},T.util.areEqualSets=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!T.util.contains(e,t[n]))return!1;return!0},T.util.containsSet=function(t,e){for(var n=0;n<t.length;n++)if(T.util.areEqualSets(t[n],e))return!0;return!1},T.util.setUnion=function(t,e){for(var n=[],a=0;a<t.length;a++)T.util.contains(n,t[a])||n.push(t[a]);for(a=0;a<e.length;a++)T.util.contains(n,e[a])||n.push(e[a]);return n},T.util.setIntersection=function(t,e){for(var n=[],a=0;a<t.length;a++)T.util.contains(e,t[a])&&n.push(t[a]);return n},T.util.clone=function(t){return JSON.parse(JSON.stringify(t))},T.util.makeCounter=function(t){return{value:t,getAndAdvance:e}},T.util.randint=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},T.util.HashTable=require("structure.js").HashTable,T.fsm={},T.fsm.epsilonSymbol="$",T.fsm.dfaType="DFA",T.fsm.nfaType="NFA",T.fsm.enfaType="eNFA",T.fsm.makeNew=function(){return{states:[],alphabet:[],acceptingStates:[],initialState:void 0,transitions:[]}},T.fsm._addStateOrSymbol=function(t,e,n,a){if(void 0===e)throw new Error(n);if(T.util.contains(t,e))throw new Error(a);return t.push(e),e},T.fsm.addState=function(t,e){return T.fsm._addStateOrSymbol(t.states,e,"No state object specified","State already exists")},T.fsm.addSymbol=function(t,e){if(T.util.areEquivalent(e,T.fsm.epsilonSymbol))throw new Error("Can't add the epsilon symbol to the alphabet");return T.fsm._addStateOrSymbol(t.alphabet,e,"No symbol object specified","Symbol already exists")},T.fsm.addAcceptingState=function(t,e){if(!T.util.contains(t.states,e))throw new Error("The specified object is not a state of the FSM");T.fsm._addStateOrSymbol(t.acceptingStates,e,"","The specified state is already accepting")},T.fsm.setInitialState=function(t,e){if(!T.util.contains(t.states,e))throw new Error("The specified object is not a state of the FSM");t.initialState=e},T.fsm._addTransition=function(t,e,n,a){if(!Array.isArray(n))throw new Error("The toStates argument must be an array");if(!T.util.contains(t.states,e)||!T.util.containsAll(t.states,n))throw new Error("One of the specified objects is not a state of the FSM");for(var i=!1,r=0;r<t.transitions.length;r++)if(T.util.areEquivalent(e,t.transitions[r].fromState)&&T.util.areEquivalent(a,t.transitions[r].symbol)){t.transitions[r].toStates=T.util.setUnion(t.transitions[r].toStates,n),i=!0;break}i||t.transitions.push({fromState:e,toStates:n,symbol:a})},T.fsm.addTransition=function(t,e,n,a){if(!T.util.contains(t.alphabet,a))throw new Error("The specified object is not an alphabet symbol of the FSM");T.fsm._addTransition(t,e,n,a)},T.fsm.addEpsilonTransition=function(t,e,n){T.fsm._addTransition(t,e,n,T.fsm.epsilonSymbol)},T.fsm.validate=function(t){var e,n,a;if(!(void 0!==t&&Array.isArray(t.states)&&Array.isArray(t.alphabet)&&Array.isArray(t.acceptingStates)&&null!=t.initialState&&Array.isArray(t.transitions)))throw new Error("FSM must be defined and have states, alphabet, acceptingStates, initialState and transitions array properties!");if(t.states.length<1)throw new Error("Set of states must not be empty.");for(e=0;e<t.states.length;e++)if(T.util.contains(t.states,t.states[e],e+1))throw new Error("Equivalent states");if(t.alphabet.length<1)throw new Error("Alphabet must not be empty.");for(e=0;e<t.alphabet.length;e++)if(T.util.contains(t.alphabet,t.alphabet[e],e+1))throw new Error("Equivalent alphabet symbols");if(T.util.contains(t.alphabet,T.fsm.epsilonSymbol))throw new Error("FSM alphabet must not contain the epsilon symbol");for(e=0;e<t.alphabet.length;e++)if(T.util.contains(t.states,t.alphabet[e]))throw new Error("States and alphabet symbols must not overlap");for(e=0;e<t.acceptingStates.length;e++){if(T.util.contains(t.acceptingStates,t.acceptingStates[e],e+1))throw new Error("Equivalent acceptingStates");if(!T.util.contains(t.states,t.acceptingStates[e]))throw new Error("Each accepting state must be in states")}if(!T.util.contains(t.states,t.initialState))throw new Error("Initial state must be in states");for(e=0;e<t.transitions.length;e++){var i=t.transitions[e];if(void 0===i.fromState||void 0===i.toStates||void 0===i.symbol)throw new Error("Transitions must have fromState, toState and symbol");if(!T.util.contains(t.states,i.fromState))throw new Error("Transition fromState must be in states.");if(!T.util.contains(t.alphabet,i.symbol)&&i.symbol!==T.fsm.epsilonSymbol)throw new Error("Transition symbol must be in alphabet.");for(a=0;a<i.toStates.length;a++){if(!T.util.contains(t.states,i.toStates[a]))throw new Error("Transition toStates must be in states.");if(T.util.contains(i.toStates,i.toStates[a],a+1))throw new Error("Transition toStates must not contain duplicates.")}}for(e=0;e<t.transitions.length;e++)for(n=e+1;n<t.transitions.length;n++)if(t.transitions[e].fromState===t.transitions[n].fromState&&t.transitions[e].symbol===t.transitions[n].symbol)throw new Error("Transitions for the same fromState and symbol must be defined in a single trainsition.");return!0},T.fsm.isAcceptingState=function(t,e){return T.util.contains(t.acceptingStates,e)},T.fsm.determineType=function(t){for(var e=T.fsm.dfaType,n=0;n<t.transitions.length;n++){var a=t.transitions[n];if(a.symbol===T.fsm.epsilonSymbol){e=T.fsm.enfaType;break}(0===a.toStates.length||1<a.toStates.length)&&(e=T.fsm.nfaType)}return e=e===T.fsm.dfaType&&t.transitions.length<t.states.length*t.alphabet.length?T.fsm.nfaType:e},T.fsm.computeEpsilonClosure=function(t,e){if(!T.util.containsAll(t.states,e))throw new Error("FSM must contain all states for which epsilon closure is being computed");for(var n=e,a=[];0!==n.length;){var i=n.pop();a.push(i);for(var r=0;r<t.transitions.length;r++){var s=t.transitions[r];if(s.symbol===T.fsm.epsilonSymbol&&T.util.areEquivalent(s.fromState,i))for(var o=0;o<s.toStates.length;o++)T.util.contains(a,s.toStates[o])||T.util.contains(n,s.toStates[o])||n.push(s.toStates[o])}}return a},T.fsm.makeSimpleTransition=function(t,e,n){if(!T.util.containsAll(t.states,e))throw new Error("FSM must contain all states for which the transition is being computed");if(!T.util.contains(t.alphabet,n))throw new Error("FSM must contain input symbol for which the transition is being computed");for(var a=[],i=0;i<t.transitions.length;i++){var r=t.transitions[i];if(T.util.areEquivalent(t.transitions[i].symbol,n)&&T.util.contains(e,r.fromState))for(var s=0;s<r.toStates.length;s++)T.util.contains(a,r.toStates[s])||a.push(r.toStates[s])}return a},T.fsm.makeTransition=function(t,e,n){if(!T.util.containsAll(t.states,e))throw new Error("FSM must contain all states for which the transition is being computed");if(T.util.contains(t.alphabet,n))return e=T.util.clone(e),e=T.fsm.computeEpsilonClosure(t,e),e=T.fsm.makeSimpleTransition(t,e,n),T.fsm.computeEpsilonClosure(t,e);throw new Error("FSM must contain input symbol for which the transition is being computed")},T.fsm.readString=function(t,e){if(!T.util.containsAll(t.alphabet,e))throw new Error("FSM must contain all symbols for which the transition is being computed");for(var n=T.fsm.computeEpsilonClosure(t,[t.initialState]),a=0;a<e.length;a++)n=T.fsm.makeTransition(t,n,e[a]);return n},T.fsm.transitionTrail=function(t,e,n){if(!T.util.containsAll(t.alphabet,n))throw new Error("FSM must contain all symbols for which the transition is being computed");for(var a=[e],i=[T.util.clone(a)],r=0;r<n.length;r++)a=T.fsm.makeTransition(t,a,n[r]),i.push(T.util.clone(a));return i},T.fsm.isStringInLanguage=function(t,e){e=T.fsm.readString(t,e);return T.util.containsAny(t.acceptingStates,e)},T.fsm.printTable=function(t){for(var e=require("cli-table"),n=[""].concat(t.alphabet),a=(T.fsm.determineType(t)===T.fsm.enfaType&&n.push(T.fsm.epsilonSymbol),n.push(""),new e({head:n,chars:{top:"-","top-mid":"+","top-left":"+","top-right":"+",bottom:"-","bottom-mid":"+","bottom-left":"+","bottom-right":"+",left:"|","left-mid":"+",mid:"-","mid-mid":"+",right:"|","right-mid":"+"},truncate:"~"})),i=[],r=0;r<t.states.length;r++){for(i.push(new Array(n.length)),c=0;c<n.length;c++)i[r][c]="";i[r][0]=t.states[r].toString(),i[r][n.length-1]=T.util.contains(t.acceptingStates,t.states[r])?"1":"0",a.push(i[r])}for(r=0;r<t.transitions.length;r++){for(var s=t.transitions[r],o=null,l=null,c=0;c<t.states.length;c++)if(T.util.areEquivalent(t.states[c],s.fromState)){l=c;break}if(s.symbol===T.fsm.epsilonSymbol)o=n.length-2;else for(c=0;c<t.alphabet.length;c++)if(T.util.areEquivalent(t.alphabet[c],s.symbol)){o=c+1;break}void 0===i[l][o].text&&(i[l][o]={text:[]}),i[l][o].text.push(s.toStates)}return a.toString()},T.fsm.serializeFsmToString=function(t){var e=[];e.push("#states");for(var n=0;n<t.states.length;n++)e.push(t.states[n].toString());e.push("#initial"),e.push(t.initialState.toString()),e.push("#accepting");for(n=0;n<t.acceptingStates.length;n++)e.push(t.acceptingStates[n].toString());e.push("#alphabet");for(n=0;n<t.alphabet.length;n++)e.push(t.alphabet[n].toString());e.push("#transitions");for(n=0;n<t.transitions.length;n++)e.push(t.transitions[n].fromState.toString()+":"+t.transitions[n].symbol.toString()+">"+t.transitions[n].toStates.join(","));return e.join("\n")},T.fsm.parseFsmFromString=function(t){for(var e,n=t.split(/\r?\n/),a=[],i=[],r=[],s=[],o=null,l={states:0,initial:0,accepting:0,alphabet:0,transitions:0},c=0;c<n.length;c++){var u=n[c].replace(/\s/g,"");if(0!==u.length)if("#"===u[0]){if(void 0===l[o=u.substr(1)])throw new Error("Line "+(c+1).toString()+": invalid section name "+o+". Must be one of: states, initial,                            accepting, alphabet, transitions.");if(l[o]+=1,1<l[o])throw new Error("Line "+(c+1).toString()+": duplicate section name "+o+".")}else{if(null==o)throw new Error("Line "+(c+1).toString()+": no #section declared.                           Add one section: states, initial, accepting,                           alphabet, transitions.");if("states"===o)var f=u.split(";"),a=a.concat(f);else if("initial"==o)e=u;else if("accepting"==o)f=u.split(";"),i=i.concat(f);else if("alphabet"==o)var h=u.split(";"),r=r.concat(h);else if("transitions"==o){for(var h=u.split(":"),u=h[0].split(","),m=h[1].split(";"),p=0;p<m.length;p++)var g=m[p].split(">"),S=g[0].split(","),d=g[1].split(",");s.push([u,S,d])}}}for(y in l)if(1!==l[y])throw new Error("Specification missing #"+l[y]+" section.");for(var b=T.fsm.makeNew(),c=a.length-1;0<=c;c--)T.fsm.addState(b,a[c]);for(c=r.length-1;0<=c;c--)T.fsm.addSymbol(b,r[c]);for(c=0;c<i.length;c++)T.fsm.addAcceptingState(b,i[c]);T.fsm.setInitialState(b,e);for(c=0;c<s.length;c++)for(var v=s[c],p=0;p<v[0].length;p++)for(var y=0;y<v[1].length;y++)v[1][y]===T.fsm.epsilonSymbol?T.fsm.addEpsilonTransition(b,v[0][p],v[2]):T.fsm.addTransition(b,v[0][p],v[2],v[1][y]);return T.fsm.validate(b),b},T.fsm.printHtmlTable=function(t){for(var e=[""].concat(t.alphabet),n=(T.fsm.determineType(t)===T.fsm.enfaType&&e.push(T.fsm.epsilonSymbol),e.push(""),[]),a=0;a<t.states.length;a++){for(n.push(new Array(e.length)),o=0;o<e.length;o++)n[a][o]={text:[]};n[a][0]={text:t.states[a].toString()},n[a][e.length-1]=T.util.contains(t.acceptingStates,t.states[a])?{text:["1"]}:{text:["0"]}}for(a=0;a<t.transitions.length;a++){for(var i=t.transitions[a],r=null,s=null,o=0;o<t.states.length;o++)if(T.util.areEquivalent(t.states[o],i.fromState)){s=o;break}if(i.symbol===T.fsm.epsilonSymbol)r=e.length-2;else for(o=0;o<t.alphabet.length;o++)if(T.util.areEquivalent(t.alphabet[o],i.symbol)){r=o+1;break}void 0===n[s][r].text&&(n[s][r]={text:[]}),n[s][r].text.push(i.toStates)}var l=[];for(l.push("<table border='1'>"),l.push("  <tr>"),a=0;a<e.length;a++)l.push("    <th>"+e[a].toString()+"</th>");for(l.push("  </tr>"),a=0;a<n.length;a++){for(l.push("  <tr>"),o=0;o<n[a].length;o++)l.push("    <td>"+n[a][o].text+"</td>");l.push("  </tr>")}return l.push("</table>"),l.join("\n")},T.fsm.printDotFormat=function(t){for(var e,n,a=["digraph finite_state_machine {","  rankdir=LR;"],i=["  node [shape = doublecircle];"],r=0;r<t.acceptingStates.length;r++)i.push(t.acceptingStates[r].toString());i.push(";"),2<i.length&&a.push(i.join(" ")),a.push("  node [shape = circle];"),a.push("  secret_node [style=invis, shape=point];");var s=["  secret_node ->"],o=(s.push(t.initialState.toString()),s.push("[style=bold];"),a.push(s.join(" ")),[]);for(r=0;r<t.transitions.length;r++)for(e=0;e<t.transitions[r].toStates.length;e++){for(var l,c=null,u=0;u<o.length;u++)T.util.areEquivalent(o[u].fromState,t.transitions[r].fromState)&&T.util.areEquivalent(o[u].toStates,[t.transitions[r].toStates[e]])&&(c=o[u]);null===c?((l=T.util.clone(t.transitions[r])).toStates=[l.toStates[e]],l.symbol=[l.symbol],o.push(l)):c.symbol.push(t.transitions[r].symbol)}for(r=0;r<o.length;r++)T.util.areEquivalent(o[r].toStates[0],t.initialState)?((n=[" "]).push(o[r].toStates[0].toString()),n.push("->"),n.push(o[r].fromState.toString()),n.push("["),n.push("label ="),n.push('"'+o[r].symbol.toString()+'"'),n.push(" dir = back];")):((n=[" "]).push(o[r].fromState.toString()),n.push("->"),n.push(o[r].toStates[0].toString()),n.push("["),n.push("label ="),n.push('"'+o[r].symbol.toString()+'"'),n.push(" ];")),a.push(n.join(" "));return a.push("}"),console.log(a),a.join("\n").replace(/\$/g,"$")},T.fsm.getReachableStates=function(t,e,n){for(var a,i=[e],r=n?[e]:[];0!==i.length;)for(var s=i.pop(),o=0;o<t.transitions.length;o++){var l=t.transitions[o];if(T.util.areEquivalent(s,l.fromState))for(a=0;a<l.toStates.length;a++)T.util.contains(r,l.toStates[a])||(r.push(l.toStates[a]),T.util.contains(i,l.toStates[a]))||i.push(l.toStates[a])}return r},T.fsm.removeUnreachableStates=function(t){var e,n=T.fsm.getReachableStates(t,t.initialState,!0),a=T.util.clone(t);for(a.states=[],a.acceptingStates=[],a.transitions=[],e=0;e<t.states.length;e++)T.util.contains(n,t.states[e])&&a.states.push(T.util.clone(t.states[e]));for(e=0;e<t.acceptingStates.length;e++)T.util.contains(n,t.acceptingStates[e])&&a.acceptingStates.push(T.util.clone(t.acceptingStates[e]));for(e=0;e<t.transitions.length;e++)T.util.contains(n,t.transitions[e].fromState)&&a.transitions.push(T.util.clone(t.transitions[e]));return a},T.fsm.areEquivalentStates=function(t,e,n,a){if(T.fsm.determineType(t)!==T.fsm.dfaType||T.fsm.determineType(n)!==T.fsm.dfaType)throw new Error("FSMs must be DFAs");if(t.alphabet.length!==n.alphabet.length||!T.util.containsAll(t.alphabet,n.alphabet))throw new Error("FSM alphabets must be the same");if(!T.util.contains(t.states,e)||!T.util.contains(n.states,a))throw new Error("FSMs must contain states");for(var i,r,s,o,l,c=[[e,a]],u=[];0!==c.length;){var f=c.pop();if(r=t,s=f[0],o=n,l=f[1],r=T.util.contains(r.acceptingStates,s),s=T.util.contains(o.acceptingStates,l),!(r&&s||!r&&!s))return!1;for(u.push(f),i=0;i<t.alphabet.length;i++){var h=[T.fsm.makeTransition(t,[f[0]],t.alphabet[i])[0],T.fsm.makeTransition(n,[f[1]],t.alphabet[i])[0]];T.util.contains(u,h)||T.util.contains(c,h)||c.push(h)}}return!0},T.fsm.areEquivalentFSMs=function(t,e){return T.fsm.areEquivalentStates(t,t.initialState,e,e.initialState)},T.fsm.removeEquivalentStates=function(t){if(T.fsm.determineType(t)!==T.fsm.dfaType)throw new Error("FSM must be DFA");for(var e,n=[],a=0;a<t.states.length;a++)for(e=a+1;e<t.states.length;e++)if(T.fsm.areEquivalentStates(t,t.states[a],t,t.states[e])){for(var i=[t.states[a],t.states[e]],r=0;r<n.length;r++)if(T.util.areEquivalent(n[r][1],i[0])){i[0]=n[r][1];break}T.util.contains(n,i)||n.push(i)}var s={states:[],alphabet:T.util.clone(t.alphabet),initialState:[],acceptingStates:[],transitions:[]};function o(t){for(var e=0;e<n.length;e++)if(T.util.areEquivalent(n[e][1],t))return 1}function l(t){for(var e=0;e<n.length;e++)if(T.util.areEquivalent(n[e][1],t))return n[e][0];return t}for(a=0;a<t.states.length;a++)o(t.states[a])||s.states.push(T.util.clone(t.states[a]));for(a=0;a<t.acceptingStates.length;a++)o(t.acceptingStates[a])||s.acceptingStates.push(T.util.clone(t.acceptingStates[a]));for(s.initialState=T.util.clone(l(t.initialState)),a=0;a<t.transitions.length;a++){var c=T.util.clone(t.transitions[a]);if(!o(c.fromState)){for(e=0;e<c.toStates.length;e++)c.toStates[e]=l(c.toStates[e]);s.transitions.push(c)}}return s},T.fsm.minimize=function(t){var e=T.fsm.determineType(t),n=t,e=(e===T.fsm.nfaType?n=T.fsm.convertNfaToDfa(t):e===T.fsm.enfaType&&(n=T.fsm.convertEnfaToNfa(t),n=T.fsm.convertNfaToDfa(n)),T.fsm.removeUnreachableStates(n));return T.fsm.removeEquivalentStates(e)},T.fsm.convertStatesToNumbers=function(t){var e=T.fsm.makeNew(),n={};for(i=0;i<t.states.length;i++)n[t.states[i].toString()]=i;for(e.alphabet=T.util.clone(t.alphabet),i=0;i<t.states.length;i++)T.fsm.addState(e,n[t.states[i].toString()]);for(T.fsm.setInitialState(e,n[t.initialState.toString()]),i=0;i<t.acceptingStates.length;i++)T.fsm.addAcceptingState(e,n[t.acceptingStates[i].toString()]);for(i=0;i<t.transitions.length;i++){var a=[];for(j=0;j<t.transitions[i].toStates.length;j++)a.push(n[t.transitions[i].toStates[j].toString()]);T.fsm.addTransition(e,n[t.transitions[i].fromState.toString()],a,t.transitions[i].symbol)}return e},T.fsm.createRandomFsm=function(t,e,n,a){var i,r,s={};function o(t,e,n){for(var a=n,i=0;i<n.length-e;i++)a=t+n;return a}for(s.states=[],i=0,len=e.toString().length;i<e;i++)s.states.push("s"+o("0",len,i.toString()));if(s.alphabet=[],26<n)for(i=0,len=n.toString().length;i<n;i++)s.alphabet.push("a"+o("0",len,i.toString()));else s.alphabet="abcdefghijklmnopqrstuvwxyz".substr(0,n).split("");for(s.initialState=s.states[0],s.acceptingStates=[],i=0;i<e;i++)Math.round(Math.random())&&s.acceptingStates.push(s.states[i]);for(t===T.fsm.enfaType&&s.alphabet.push(T.fsm.epsilonSymbol),s.transitions=[],i=0;i<e;i++)for(r=0;r<s.alphabet.length;r++){var l=1;if(0<(l=t!==T.fsm.dfaType?Math.floor(Math.random()*a):l)){for(var c=[],u=0;u<s.states.length&&c.length<l;u++){var f=(f=s.states.length-u-(l-c.length)+1)<=0?1:1/f;Math.random()<=f&&c.push(s.states[u])}s.transitions.push({fromState:s.states[i],symbol:s.alphabet[r],toStates:c})}}return t===T.fsm.enfaType&&s.alphabet.pop(),s},T.fsm.convertNfaToDfa=function(t){var e=T.fsm.determineType(t);if(e===T.fsm.enfaType)throw new Error("FSM must be an NFA");if(e===T.fsm.dfaType)return t;var n,a={};for(a.alphabet=T.util.clone(t.alphabet),a.states=[],a.acceptingStates=[],a.initialState=[T.util.clone(t.initialState)],a.transitions=[],r=0;r<t.states.length;r++)a.states.push([T.util.clone(t.states[r])]);for(r=0;r<t.acceptingStates.length;r++)a.acceptingStates.push([T.util.clone(t.acceptingStates[r])]);for(var i=[],r=0;r<t.transitions.length;r++)(n=T.util.clone(t.transitions[r])).fromState=[n.fromState],n.toStates=[n.toStates],1<n.toStates[0].length&&(T.util.containsSet(i,n.toStates[0])||i.push(n.toStates[0])),a.transitions.push(n);for(;0!==i.length;){var s=i.pop();for(a.states.push(s),T.util.containsAny(t.acceptingStates,s)&&a.acceptingStates.push(s),r=0;r<a.alphabet.length;r++){for(var o=T.fsm.makeTransition(t,s,a.alphabet[r]).sort(),l=0;l<a.states.length;l++)if(T.util.areEqualSets(o,a.states[l])){o=a.states[l];break}for(l=0;l<i.length;l++)if(T.util.areEqualSets(o,i[l])){o=i[l];break}0<o.length&&a.transitions.push({fromState:s,symbol:a.alphabet[r],toStates:[o]}),!T.util.containsSet(a.states,o)&&!T.util.containsSet(i,o)&&1<o.length&&i.push(o)}}var c=!1;for(r=0;r<a.states.length;r++)for(l=0;l<a.alphabet.length;l++){for(var u=!1,f=0;f<a.transitions.length;f++)if(n=a.transitions[f],T.util.areEquivalent(n.symbol,a.alphabet[l])&&T.util.areEquivalent(n.fromState,a.states[r])){u=!0;break}!1===u&&(!1===c&&(a.states.push(["ERROR"]),c=!0),a.transitions.push({fromState:a.states[r],symbol:a.alphabet[l],toStates:[["ERROR"]]}))}return a},T.fsm.convertEnfaToNfa=function(t){if(T.fsm.determineType(t)!==T.fsm.enfaType)return t;for(var e=T.util.clone(t),t=T.fsm.computeEpsilonClosure(t,[t.initialState]),n=(T.util.containsAny(e.acceptingStates,t)&&!T.util.contains(e.acceptingStates,e.initialState)&&e.acceptingStates.push(e.initialState),[]),a=0;a<e.states.length;a++)for(l=0;l<e.alphabet.length;l++){var i=T.fsm.makeTransition(e,[e.states[a]],e.alphabet[l]).sort();0<i.length&&n.push({fromState:e.states[a],toStates:i,symbol:e.alphabet[l]})}e.transitions=n;var r=[];for(a=0;a<e.transitions.length;a++){var s=e.transitions[a];if(1<s.toStates.length){for(var o=!1,l=0;l<r.length;l++)if(T.util.areEqualSets(s.toStates,r[l])){s.toStates=r[l],o=!0;break}!1===o&&r.push(s.toStates)}}return e},T.fsm.isLanguageNonEmpty=function(t){var e=T.fsm.determineType(t),n=t;return e===T.fsm.nfaType?n=T.fsm.convertNfaToDfa(t):e===T.fsm.enfaType&&(n=T.fsm.convertEnfaToNfa(t),n=T.fsm.convertNfaToDfa(n)),0<(n=T.fsm.minimize(n)).acceptingStates.length},T.fsm.isLanguageInfinite=function(t){for(var e,n=T.fsm.determineType(t),a=t,i=(n===T.fsm.nfaType?a=T.fsm.convertNfaToDfa(t):n===T.fsm.enfaType&&(a=T.fsm.convertEnfaToNfa(t),a=T.fsm.convertNfaToDfa(a)),a=T.fsm.minimize(a),null),r=0;r<a.states.length;r++)if(!T.util.contains(a.acceptingStates,a.states[r])&&(e=T.fsm.getReachableStates(a,a.states[r],!0),!T.util.containsAny(a.acceptingStates,e))){i=a.states[r];break}if(null===i)return!0;for(r=0;r<a.states.length;r++)if(!T.util.areEquivalent(i,a.states[r])&&(e=T.fsm.getReachableStates(a,a.states[r],!1),T.util.contains(e,a.states[r])))return!0;return!1},T.fsm.randomStringInLanguage=function(t){var e=T.fsm.determineType(t),n=t;if(e===T.fsm.nfaType?n=T.fsm.convertNfaToDfa(t):e===T.fsm.enfaType&&(n=T.fsm.convertEnfaToNfa(t),n=T.fsm.convertNfaToDfa(n)),0===(n=T.fsm.minimize(n)).acceptingStates.length)return null;for(var a=n.acceptingStates[Math.floor(Math.random()*n.acceptingStates.length)],i=[];!0!==T.util.areEquivalent(a,n.initialState)||!Math.round(Math.random());){for(var r=[],s=0;s<n.transitions.length;s++)T.util.areEquivalent(n.transitions[s].toStates[0],a)&&r.push(n.transitions[s]);if(0===r.length)break;var o=r[Math.floor(Math.random()*r.length)];i.push(o.symbol),a=o.fromState}return i.reverse(),i},T.fsm.randomStringNotInLanguage=function(t){var e=T.fsm.determineType(t),n=t,a=(e===T.fsm.nfaType?n=T.fsm.convertNfaToDfa(t):e===T.fsm.enfaType&&(n=T.fsm.convertEnfaToNfa(t),n=T.fsm.convertNfaToDfa(n)),n=T.fsm.minimize(n),[]);for(o=0;o<n.states.length;o++)T.util.contains(n.acceptingStates,n.states[o])||a.push(n.states[o]);if(0===a.length)return null;for(var i=a[Math.floor(Math.random()*a.length)],r=[];!0!==T.util.areEquivalent(i,n.initialState)||!Math.round(Math.random());){for(var s=[],o=0;o<n.transitions.length;o++)T.util.areEquivalent(n.transitions[o].toStates[0],i)&&s.push(n.transitions[o]);if(0===s.length)break;var l=s[Math.floor(Math.random()*s.length)];r.push(l.symbol),i=l.fromState}return r.reverse(),r},T.fsm.union=function(t,e){if(!T.util.areEquivalent(t.alphabet,e.alphabet))throw new Error("Alphabets must be the same");for(var n,a,i={alphabet:T.util.clone(t.alphabet),states:[],initialState:[T.util.clone(t.initialState),T.util.clone(e.initialState)],acceptingStates:[],transitions:[]},r=0;r<t.states.length;r++)for(n=0;n<e.states.length;n++){var s=[T.util.clone(t.states[r]),T.util.clone(e.states[n])];for(i.states.push(s),(T.util.contains(t.acceptingStates,t.states[r])||T.util.contains(e.acceptingStates,e.states[n]))&&i.acceptingStates.push(s),a=0;a<i.alphabet.length;a++)i.transitions.push({fromState:s,symbol:i.alphabet[a],toStates:[[T.fsm.makeTransition(t,[t.states[r]],i.alphabet[a])[0],T.fsm.makeTransition(e,[e.states[n]],i.alphabet[a])[0]]]})}return i},T.fsm.intersection=function(t,e){for(var n,a,i={alphabet:T.util.clone(T.util.setIntersection(t.alphabet,e.alphabet)),states:[],initialState:[T.util.clone(t.initialState),T.util.clone(e.initialState)],acceptingStates:[],transitions:[]},r=0;r<t.states.length;r++)for(n=0;n<e.states.length;n++){var s=[T.util.clone(t.states[r]),T.util.clone(e.states[n])];for(i.states.push(s),T.util.contains(t.acceptingStates,t.states[r])&&T.util.contains(e.acceptingStates,e.states[n])&&i.acceptingStates.push(s),a=0;a<i.alphabet.length;a++)i.transitions.push({fromState:s,symbol:i.alphabet[a],toStates:[[T.fsm.makeTransition(t,[t.states[r]],i.alphabet[a])[0],T.fsm.makeTransition(e,[e.states[n]],i.alphabet[a])[0]]]})}return i},T.fsm.difference=function(t,e){if(!T.util.areEquivalent(t.alphabet,e.alphabet))throw new Error("Alphabets must be the same");for(var n,a,i={alphabet:T.util.clone(t.alphabet),states:[],initialState:[T.util.clone(t.initialState),T.util.clone(e.initialState)],acceptingStates:[],transitions:[]},r=0;r<t.states.length;r++)for(n=0;n<e.states.length;n++){var s=[T.util.clone(t.states[r]),T.util.clone(e.states[n])];for(i.states.push(s),T.util.contains(t.acceptingStates,t.states[r])&&!T.util.contains(e.acceptingStates,e.states[n])&&i.acceptingStates.push(s),a=0;a<i.alphabet.length;a++)i.transitions.push({fromState:s,symbol:i.alphabet[a],toStates:[[T.fsm.makeTransition(t,[t.states[r]],i.alphabet[a])[0],T.fsm.makeTransition(e,[e.states[n]],i.alphabet[a])[0]]]})}return i},T.fsm.complement=function(t){for(var e=T.util.clone(t),n=[],a=0;a<e.states.length;a++)T.util.contains(e.acceptingStates,e.states[a])||n.push(e.states[a]);return e.acceptingStates=n,e},T.fsm.concatenation=function(t,e){if(!T.util.areEquivalent(t.alphabet,e.alphabet))throw new Error("Alphabets must be the same");if(T.util.containsAny(t.states,e.states))throw new Error("States must not overlap");for(var n={alphabet:T.util.clone(t.alphabet),states:T.util.clone(t.states).concat(T.util.clone(e.states)),initialState:T.util.clone(t.initialState),acceptingStates:T.util.clone(e.acceptingStates),transitions:T.util.clone(t.transitions).concat(T.util.clone(e.transitions))},a=0;a<t.acceptingStates.length;a++)n.transitions.push({fromState:T.util.clone(t.acceptingStates[a]),toStates:[T.util.clone(e.initialState)],symbol:T.fsm.epsilonSymbol});return n},T.fsm.kleene=function(t){var e=T.util.clone(t),n="NEW_INITIAL";e.states.push(n),e.transitions.push({fromState:n,toStates:[e.initialState],symbol:T.fsm.epsilonSymbol}),e.initialState=n;for(var a=0;a<e.acceptingStates.length;a++)e.transitions.push({fromState:e.acceptingStates[a],toStates:[n],symbol:T.fsm.epsilonSymbol});return e},T.fsm.reverse=function(t){for(var e=T.util.clone(t),n=[],a=0;a<e.transitions.length;a++)for(var i=0;i<e.transitions[a].toStates.length;i++)n.push({fromState:e.transitions[a].toStates[i],toStates:[e.transitions[a].fromState],symbol:e.transitions[a].symbol});e.transitions=n;var t=e.acceptingStates,r=(e.acceptingStates=[e.initialState],"NEW_INITIAL");return e.states.push(r),e.initialState=r,e.transitions.push({fromState:r,toStates:t,symbol:T.fsm.epsilonSymbol}),e},T.fsm.isSubset=function(t,e){t=T.fsm.intersection(t,e);return T.fsm.areEquivalentFSMs(e,t)},T.fsm.grammar=function(t){for(var e={nonterminals:T.util.clone(t.states),terminals:T.util.clone(t.alphabet),initialNonterminal:T.util.clone(t.initialState),productions:[]},n=0;n<t.transitions.length;n++)t.transitions[n].symbol===T.fsm.epsilonSymbol?e.productions.push({left:[T.util.clone(t.transitions[n].fromState)],right:T.util.clone(t.transitions[n].toStates)}):e.productions.push({left:[T.util.clone(t.transitions[n].fromState)],right:[T.util.clone(t.transitions[n].symbol)].concat(T.util.clone(t.transitions[n].toStates))});for(n=0;n<t.acceptingStates.length;n++)e.productions.push({left:[T.util.clone(t.acceptingStates[n])],right:[T.grammar.epsilonSymbol]});return e},T.fsm.symbolsForTransitions=function(t,e,n){for(var a=[],i=0;i<t.transitions.length;i++){var r=t.transitions[i];T.util.areEquivalent(r.fromState,e)&&T.util.contains(r.toStates,n)&&a.push(r.symbol)}return a},T.fsm.toRegex=function(t){for(var e,n=[],a=t.states.length,i=0;i<a+1;i++)for(n[i]=[],m=0;m<a;m++)n[i][m]=[];for(m=0;m<a;m++)for(e=0;e<a;e++){for(var r=T.fsm.symbolsForTransitions(t,t.states[m],t.states[e]),s=0;s<r.length;s++)r[s]=T.re.tree.makeLit(r[s]);m===e&&r.push(T.re.tree.makeEps()),n[0][m][e]=T.re.tree.makeAlt(r)}for(i=1;i<a+1;i++)for(m=0;m<a;m++)for(e=0;e<a;e++){var o=void 0!==n[i-1][m][i-1].choices&&0===n[i-1][m][i-1].choices.length||void 0!==n[i-1][i-1][e].choices&&0===n[i-1][i-1][e].choices.length||void 0!==n[i-1][i-1][i-1].choices&&0===n[i-1][i-1][i-1].choices.length,l=void 0!==n[i-1][m][e].choices&&0===n[i-1][m][e].choices.length,c=null,c=n[i-1][i-1][i-1].tag===T.re.tree.tags.EPS?T.re.tree.makeSeq([n[i-1][m][i-1],n[i-1][i-1][e]]):T.re.tree.makeSeq([n[i-1][m][i-1],T.re.tree.makeKStar(n[i-1][i-1][i-1]),n[i-1][i-1][e]]),u=[];l||u.push(n[i-1][m][e]),o||u.push(c),u=T.re.tree.makeAlt(u),n[i][m][e]=u}for(var f=-1,h=[],m=0;m<t.states.length;m++)T.util.areEquivalent(t.states[m],t.initialState)&&(f=m),T.util.contains(t.acceptingStates,t.states[m])&&h.push(m);var p=[];for(m=0;m<h.length;m++)p.push(n[a][f][h[m]]);return T.re.tree.makeAlt(p)},T.grammar={},T.grammar.epsilonSymbol="$",T.grammar.regType="regular",T.grammar.cfgType="context-free",T.grammar.csgType="context-sensitive",T.grammar.unrestrictedType="unrestricted",T.grammar.validate=function(t){if(!(void 0!==t&&Array.isArray(t.nonterminals)&&Array.isArray(t.terminals)&&null!=t.initialNonterminal&&Array.isArray(t.productions)))throw new Error("Grammar must be defined and have nonterminals, terminals, initialNonterminal and productions array properties!");var e,n;if(t.nonterminals.length<1)throw new Error("Set of nonterminals must not be empty.");if(t.terminals.length<1)throw new Error("Set of terminals must not be empty.");for(e=0;e<t.nonterminals.length;e++)if(T.util.contains(t.nonterminals,t.nonterminals[e],e+1))throw new Error("Equivalent nonterminals");for(e=0;e<t.terminals.length;e++)if(T.util.contains(t.terminals,t.terminals[e],e+1))throw new Error("Equivalent terminals");for(e=0;e<t.terminals.length;e++)if(T.util.contains(t.nonterminals,t.terminals[e]))throw new Error("Terminals and nonterminals must not overlap");if(!T.util.contains(t.nonterminals,t.initialNonterminal))throw new Error("InitialNonterminal must be in nonterminals");for(e=0;e<t.productions.length;e++){var a=t.productions[e];if(!Array.isArray(a.left))throw new Error("Left side of production must be an array");if(0===a.left.length)throw new Error("Left side of production must have at least one terminal or nonterminal");for(n=0;n<a.left.length;n++)if(!T.util.contains(t.nonterminals,a.left[n])&&!T.util.contains(t.terminals,a.left[n]))throw new Error("Left side of production must be in nonterminals or terminals");if(!Array.isArray(a.right))throw new Error("Right side of production must be an array");if(1!==a.right.length||a.right[0]!==T.grammar.epsilonSymbol){if(0===a.right.length)throw new Error("Right side of production must have at least one terminal or nonterminal or epsilon symbol");for(n=0;n<a.right.length;n++)if(!T.util.contains(t.nonterminals,a.right[n])&&!T.util.contains(t.terminals,a.right[n]))throw new Error("Right side of production must be in nonterminals or terminals")}if(T.util.contains(t.productions,a,e+1))throw new Error("Grammar must not have duplicate productions")}return!0},T.grammar.determineType=function(t){for(var e=T.grammar.regType,n=null,a=0;a<t.productions.length;a++){var i=t.productions[a];if(e===T.grammar.regType)if(1===i.left.length&&T.util.contains(t.nonterminals,i.left[0])){if(1===i.right.length)continue;for(var r=0,s=-1,o=0;o<i.right.length;o++)T.util.contains(t.nonterminals,i.right[o])&&(r+=1,s=o);if(1<r)e=T.grammar.cfgType;else{if(0===r)continue;if(0===s){if(null===n){n=!1;continue}if(!1===n)continue;!0===n&&(e=T.grammar.cfgType)}else if(s===i.right.length-1){if(null===n){n=!0;continue}if(!0===n)continue;!1===n&&(e=T.grammar.cfgType)}else e=T.grammar.cfgType}}else e=T.grammar.cfgType;if((e=e!==T.grammar.cfgType||1===i.left.length&&T.util.contains(t.nonterminals,i.left[0])?e:T.grammar.csgType)===T.grammar.csgType){var l=0;for(s=-1,o=0;o<i.left.length;o++)T.util.contains(t.nonterminals,i.left[o])&&(l+=1,s=o);if(1<l)return T.grammar.unrestrictedType;var c=i.left.slice(0,s-1),u=i.left.slice(s);for(o=0;o<c.length;o++)if(!T.util.areEquivalent(c[o],i.right[o]))return T.grammar.unrestrictedType;for(o=0;o<u.length;o++)if(!T.util.areEquivalent(u[u.length-o-1],i.right[i.right.length-o-1]))return T.grammar.unrestrictedType;if(i.right.length<=c.length+u.length)return T.grammar.unrestrictedType}}return e},T.grammar.printAscii=function(t){for(var e,n=[],a=(n.push("Initial nonterminal: <"+t.initialNonterminal+">"),[]),i=0;i<t.productions.length;i++){for(var r=-1,s=0;s<a.length;s++)if(T.util.areEquivalent(a[s][0],t.productions[i].left)){r=s;break}-1===r?a[a.length]=[t.productions[i].left,[t.productions[i].right]]:a[r][1].push(t.productions[i].right)}for(i=0;i<a.length;i++){var o=[];for(s=0;s<a[i][0].length;s++)T.util.contains(t.nonterminals,a[i][0][s])?o.push("<"+a[i][0][s].toString()+">"):a[i][0][s]===T.grammar.epsilonSymbol?o.push(a[i][0][s].toString()):o.push('"'+a[i][0][s].toString()+'"');for(o.push("->"),s=0;s<a[i][1].length;s++){for(e=0;e<a[i][1][s].length;e++)T.util.contains(t.nonterminals,a[i][1][s][e])?o.push("<"+a[i][1][s][e].toString()+">"):a[i][1][s][e]===T.grammar.epsilonSymbol?o.push(a[i][1][s][e].toString()):o.push('"'+a[i][1][s][e].toString()+'"');s<a[i][1].length-1&&o.push("|")}n.push(o.join(" "))}return n.join("\n")},T.re=(l={ALT:"alt",SEQ:"sequence",KSTAR:"kleene_star",LIT:"literal",EPS:"epsilon"},(o=[]).push({pattern:"(a()) => ()",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&1<=t.elements.length)for(var n=0;n<t.elements.length;n++)if(t.elements[n].tag===l.SEQ&&0===t.elements[n].elements.length||t.elements[n].tag===l.ALT&&0===t.elements[n].choices.length)return t.elements=[],!0;return!1}}),o.push({pattern:"()* => ()",type:"structure",function:function(t,e){return t.tag===l.KSTAR&&t.expr.tag===l.SEQ&&0===t.expr.elements.length&&(t.tag=l.SEQ,delete t.expr,t.elements=[],!0)}}),o.push({pattern:"(a) => a",type:"structure",function:function(t,e){return t.tag===l.SEQ&&1===t.elements.length&&(t.tag=t.elements[0].tag,f(t,t.elements[0]),!0)}}),o.push({pattern:"(a) => a",type:"structure",function:function(t,e){return t.tag===l.ALT&&1===t.choices.length&&(t.tag=t.choices[0].tag,f(t,t.choices[0]),!0)}}),o.push({pattern:"$* => $",type:"structure",function:function(t,e){return t.tag===l.KSTAR&&t.expr.tag===l.EPS&&(t.tag=t.expr.tag,delete t.expr,!0)}}),o.push({pattern:"(a*)* => a*",type:"structure",function:function(t,e){return t.tag===l.KSTAR&&t.expr.tag===l.KSTAR&&(t.expr=t.expr.expr,!0)}}),o.push({pattern:"(a+b*)* => (a+b)*",type:"structure",function:function(t,e){if(t.tag===l.KSTAR&&t.expr.tag===l.ALT)for(var n=0;n<t.expr.choices.length;n++)if(t.expr.choices[n].tag===l.KSTAR)return t.expr.choices[n]=t.expr.choices[n].expr,!0;return!1}}),o.push({pattern:"$+a* => a*",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length){for(var n=-1,a=-1,i=0;i<t.choices.length;i++)t.choices[i].tag===l.EPS?n=i:t.choices[i].tag===l.KSTAR&&(a=i);if(0<=n&&0<=a)return t.choices.splice(n,1),!0}return!1}}),o.push({pattern:"(a*b*)* => (a*+b*)*",type:"structure",function:function(t,e){if(t.tag===l.KSTAR&&t.expr.tag===l.SEQ&&0<t.expr.elements.length){for(var n=!0,a=0;a<t.expr.elements.length;a++)if(t.expr.elements[a].tag!==l.KSTAR){n=!1;break}if(n)return t.expr.tag=l.ALT,t.expr.choices=t.expr.elements,delete t.expr.elements,!0}return!1}}),o.push({pattern:"$a => a",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&2<=t.elements.length){for(var n=-1,a=0;a<t.elements.length;a++)t.elements[a].tag===l.EPS&&(n=a);if(0<=n)return t.elements.splice(n,1),!0}return!1}}),o.push({pattern:"a+a => a",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length)for(var n=0;n<t.choices.length-1;n++){for(var a=-1,i=n+1;i<t.choices.length;i++)if(T.util.areEquivalent(t.choices[n],t.choices[i])){a=i;break}if(0<=a)return t.choices.splice(a,1),!0}return!1}}),o.push({pattern:"a+a* => a*",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length)for(var n=0;n<t.choices.length-1;n++){for(var a=-1,i=n+1;i<t.choices.length;i++){if(t.choices[i].tag===l.KSTAR&&T.util.areEquivalent(t.choices[i].expr,t.choices[n])){a=n;break}if(t.choices[n].tag===l.KSTAR&&T.util.areEquivalent(t.choices[n].expr,t.choices[i])){a=i;break}}if(0<=a)return t.choices.splice(a,1),!0}return!1}}),o.push({pattern:"a*a* => a*",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&2<=t.elements.length){for(var n=-1,a=0;a<t.elements.length-1;a++)if(t.elements[a].tag===l.KSTAR&&t.elements[a+1].tag===l.KSTAR&&T.util.areEquivalent(t.elements[a],t.elements[a+1])){n=a;break}if(0<=n)return t.elements.splice(n+1,1),!0}return!1}}),o.push({pattern:"(aa+a)* => (a)*",type:"structure",function:function(t,e){if(t.tag===l.KSTAR&&t.expr.tag===l.ALT&&2<=t.expr.choices.length)for(var n=0;n<t.expr.choices.length;n++)for(var a=0;a<t.expr.choices.length;a++)if(n!==a&&t.expr.choices[a].tag===l.SEQ&&2<=t.expr.choices[a].elements.length){for(var i=!0,r=0;r<t.expr.choices[a].elements.length;r++)if(!T.util.areEquivalent(t.expr.choices[n],t.expr.choices[a].elements[r])){i=!1;break}if(i)return t.expr.choices.splice(a,1),!0}return!1}}),o.push({pattern:"(a + $)* => (a)*",type:"structure",function:function(t,e){if(t.tag===l.KSTAR&&t.expr.tag===l.ALT&&2<=t.expr.choices.length)for(var n=0;n<t.expr.choices.length;n++)if(t.expr.choices[n].tag===l.EPS)return t.expr.choices.splice(n,1),!0;return!1}}),o.push({pattern:"(ab+ac) => a(b+c)",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length)for(var n=0;n<t.choices.length-1;n++)if(t.choices[n].tag===l.SEQ&&2<=t.choices[n].elements.length)for(var a,i,r,s=n+1;s<t.choices.length;s++)if(t.choices[s].tag===l.SEQ&&2<=t.choices[s].elements.length)if(T.util.areEquivalent(t.choices[s].elements[0],t.choices[n].elements[0]))return r=t.choices[n].elements[0],a=p(t.choices[n].elements.slice(1)),i=p(t.choices[s].elements.slice(1)),r=p([r,m([a,i])]),t.choices[n]=r,t.choices.splice(s,1),!0;return!1}}),o.push({pattern:"a*aa* => aa*",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&3<=t.elements.length)for(var n=1;n<t.elements.length-1;n++)if(t.elements[n-1].tag===l.KSTAR&&t.elements[n+1].tag===l.KSTAR&&T.util.areEquivalent(t.elements[n-1],t.elements[n+1])&&T.util.areEquivalent(t.elements[n-1].expr,t.elements[n]))return t.elements.splice(n-1,1),!0;return!1}}),o.push({pattern:"(ab+cb) => (a+c)b",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length)for(var n=0;n<t.choices.length-1;n++)if(t.choices[n].tag===l.SEQ&&2<=t.choices[n].elements.length)for(var a,i,r,s=n+1;s<t.choices.length;s++)if(t.choices[s].tag===l.SEQ&&2<=t.choices[s].elements.length)if(T.util.areEquivalent(t.choices[s].elements[t.choices[s].elements.length-1],t.choices[n].elements[t.choices[n].elements.length-1]))return a=t.choices[n].elements[t.choices[n].elements.length-1],r=p(t.choices[n].elements.slice(0,t.choices[n].elements.length-1)),i=p(t.choices[s].elements.slice(0,t.choices[s].elements.length-1)),r=p([m([r,i]),a]),t.choices[n]=r,t.choices.splice(s,1),!0;return!1}}),o.push({pattern:"a*($+b(a+b)*) => (a+b)*",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&1<t.elements.length)for(var n=0;n<t.elements.length-1;n++)if(t.elements[n].tag===l.KSTAR&&t.elements[n+1].tag===l.ALT&&2===t.elements[n+1].choices.length){var a=T.util.index(t.elements[n+1].choices,c);if(0<=a){a=0===a?t.elements[n+1].choices[1]:t.elements[n+1].choices[0];if(a.tag===l.SEQ&&2===a.elements.length&&a.elements[1].tag===l.KSTAR&&a.elements[1].expr.tag===l.ALT&&2===a.elements[1].expr.choices.length&&T.util.contains(a.elements[1].expr.choices,t.elements[n].expr)&&T.util.contains(a.elements[1].expr.choices,a.elements[0]))return t.elements[n+1]=a.elements[1],t.elements.splice(n,1),!0}}return!1}}),o.push({pattern:"($+(a+b)*a)b* => (a+b)*",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&1<t.elements.length)for(var n=1;n<t.elements.length;n++)if(t.elements[n].tag===l.KSTAR&&t.elements[n-1].tag===l.ALT&&2===t.elements[n-1].choices.length){var a=T.util.index(t.elements[n-1].choices,c);if(0<=a){a=0===a?t.elements[n-1].choices[1]:t.elements[n-1].choices[0];if(a.tag===l.SEQ&&2===a.elements.length&&a.elements[0].tag===l.KSTAR&&a.elements[0].expr.tag===l.ALT&&2===a.elements[0].expr.choices.length&&T.util.contains(a.elements[0].expr.choices,t.elements[n].expr)&&T.util.contains(a.elements[0].expr.choices,a.elements[1]))return t.elements[n-1]=a.elements[0],t.elements.splice(n,1),!0}}return!1}}),o.push({pattern:"$+L => L, if L contains $",type:"fsm",function:function(t,e){if(t.tag===l.ALT&&1<t.choices.length){var n=T.util.index(t.choices,c);if(0<=n)for(var a=0;a<t.choices.length;a++)if(t.choices[a].tag!==l.EPS){var i=h(t.choices[a],e);if(T.fsm.isAcceptingState(i,i.initialState))return t.choices.splice(n,1),!0}}return!1}}),o.push({pattern:"L1+L2 => L2, if L1 is subset of L2",type:"fsm",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length)for(var n=[],a=(n.push(h(t.choices[0],e)),-1),i=0;i<t.choices.length-1;i++)for(var r=i+1;r<t.choices.length;r++){n.length<=r&&n.push(h(t.choices[r],e));try{T.fsm.isSubset(n[i],n[r])&&(a=r)}catch(t){}try{T.fsm.isSubset(n[r],n[i])&&(a=i)}catch(t){}if(0<=a)return t.choices.splice(a,1),!0}return!1}}),o.push({pattern:"(L1+L2)* => L2, if L1* is subset of L2*",type:"fsm",function:function(t,e){if(t.tag===l.KSTAR&&t.expr.tag===l.ALT&&2<=t.expr.choices.length)for(var n=[],a=(n.push(h(g(t.expr.choices[0]),e)),-1),i=0;i<t.expr.choices.length-1;i++)for(var r=i+1;r<t.expr.choices.length;r++){n.length<=r&&n.push(h(g(t.expr.choices[r]),e));try{T.fsm.isSubset(n[i],n[r])&&(a=r)}catch(t){}try{T.fsm.isSubset(n[r],n[i])&&(a=i)}catch(t){}if(0<=a)return t.expr.choices.splice(a,1),!0}return!1}}),o.push({pattern:"L1*L2* => L2, if L1* is subset of L2*",type:"fsm",function:function(t,e){if(t.tag===l.SEQ&&2<=t.elements.length)for(var n=[],a=(n.push(h(t.elements[0],e)),-1),i=0;i<t.elements.length-1;i++)if(n.push(h(t.elements[i+1],e)),t.elements[i].tag===l.KSTAR&&t.elements[i+1].tag===l.KSTAR){try{T.fsm.isSubset(n[i],n[i+1])&&(a=i+1)}catch(t){}try{T.fsm.isSubset(n[i+1],n[i])&&(a=i)}catch(t){}if(0<=a)return t.elements.splice(a,1),!0}return!1}}),o.push({pattern:"(L1+$)(L2)* => (L2)* if L1 is subset of L2",type:"fsm",function:function(t,e){if(t.tag===l.SEQ&&1<t.elements.length)for(var n,a=0;a<t.elements.length;a++)if(t.elements[a].tag===l.KSTAR)if(0<a&&t.elements[a-1].tag===l.ALT&&1<t.elements[a-1].choices.length){if(0<=(n=T.util.index(t.elements[a-1].choices,c))){var i=t.elements[a-1].choices.splice(n,1)[0],r=h(t.elements[a],e),s=h(t.elements[a-1],e),o=!1;try{T.fsm.isSubset(r,s)&&(o=!0)}catch(t){}if(o)return t.elements.splice(a-1,1),!0;t.elements[a-1].choices.splice(n,0,i)}}else if(a<t.elements.length-1&&t.elements[a+1].tag===l.ALT&&1<t.elements[a+1].choices.length)if(0<=(n=T.util.index(t.elements[a+1].choices,c))){i=t.elements[a+1].choices.splice(n,1)[0],r=h(t.elements[a],e),s=h(t.elements[a+1],e),o=!1;try{T.fsm.isSubset(r,s)&&(o=!0)}catch(t){}if(o)return t.elements.splice(a+1,1),!0;t.elements[a+1].choices.splice(n,0,i)}}}),o.push({pattern:"ab(cd) => abcd",type:"structure",function:function(t,e){if(t.tag===l.SEQ&&2<=t.elements.length){for(var n=-1,a=0;a<t.elements.length;a++)if(t.elements[a].tag===l.SEQ){n=a;break}if(0<=n){var i=t.elements[a];for(t.elements.splice(a,1),a=0;a<i.elements.length;a++)t.elements.splice(n+a,0,i.elements[a]);return!0}}return!1}}),o.push({pattern:"(a+(b+c)) => a+b+c",type:"structure",function:function(t,e){if(t.tag===l.ALT&&2<=t.choices.length){for(var n=-1,a=0;a<t.choices.length;a++)t.choices[a].tag===l.ALT&&(n=a);if(0<=n){var i=t.choices[n];for(t.choices.splice(n,1),a=0;a<i.choices.length;a++)t.choices.splice(n+a,0,i.choices[a]);return!0}}return!1}}),c={tag:l.EPS},(a={})[l.ALT]=function(t,e,n){for(var a=T.fsm.addState(e,n.getAndAdvance()),i=T.fsm.addState(e,n.getAndAdvance()),r=0;r<t.choices.length;r++){var s=b(t.choices[r],e,n);T.fsm.addEpsilonTransition(e,a,[s[0]]),T.fsm.addEpsilonTransition(e,s[1],[i])}return[a,i]},a[l.SEQ]=function(t,e,n){for(var a,i,r,s=0;s<t.elements.length;s++)r=b(t.elements[s],e,n),0===s?a=r[0]:T.fsm.addEpsilonTransition(e,i,[r[0]]),i=r[1];return void 0===a&&(a=T.fsm.addState(e,n.getAndAdvance()),i=T.fsm.addState(e,n.getAndAdvance())),[a,i]},a[l.KSTAR]=function(t,e,n){var a=T.fsm.addState(e,n.getAndAdvance()),i=T.fsm.addState(e,n.getAndAdvance()),n=(t=b(t.expr,e,n))[0],t=t[1];return T.fsm.addEpsilonTransition(e,a,[i]),T.fsm.addEpsilonTransition(e,a,[n]),T.fsm.addEpsilonTransition(e,t,[n]),T.fsm.addEpsilonTransition(e,t,[i]),[a,i]},a[l.LIT]=function(t,e,n){var a=T.fsm.addState(e,n.getAndAdvance()),n=T.fsm.addState(e,n.getAndAdvance());try{T.fsm.addSymbol(e,t.obj)}catch(t){}return T.fsm.addTransition(e,a,[n],t.obj),[a,n]},a[l.EPS]=function(t,e,n){var a=T.fsm.addState(e,n.getAndAdvance()),n=T.fsm.addState(e,n.getAndAdvance());return T.fsm.addEpsilonTransition(e,a,[n]),[a,n]},(r={})[l.ALT]=0,r[l.SEQ]=1,r[l.KSTAR]=2,r[l.LIT]=3,r[l.EPS]=3,(n={})[l.ALT]=function(t,e){y(t,e,t.choices,T.re.array.specials.ALT)},n[l.SEQ]=function(t,e){y(t,e,t.elements)},n[l.KSTAR]=function(t,e){v(t,t.expr,e),e.push(T.re.array.specials.KSTAR)},n[l.LIT]=function(t,e){e.push(t.obj)},n[l.EPS]=function(t,e){e.push(T.re.array.specials.EPS)},t={tags:l,makeAlt:m,makeSeq:p,makeKStar:g,makeLit:S,makeEps:d,toAutomaton:function(t){var e=T.fsm.makeNew(),t=b(t,e,T.util.makeCounter(0));return T.fsm.setInitialState(e,t[0]),T.fsm.addAcceptingState(e,t[1]),e},toArray:A,toString:function(t){return T.re.array.toString(A(t))},random:function(t,e,n){var a=.5,i=.1,r=.1;return n&&(n.ALT_PROB&&(a=n.ALT_PROB),n.KLEENE_PROB&&(i=n.KLEENE_PROB),n.EPS_PROB)&&(r=n.EPS_PROB),w(t,e,a,i,r)},simplify:function(t,e){for(var n=T.util.clone(t),a=T.util.clone(e=void 0===e?{}:e),i=(void 0===a.numIterations&&(a.numIterations=null),a.appliedPatterns=void 0===a.appliedPatterns?null:e.appliedPatterns,void 0===a.useFsmPatterns&&(a.useFsmPatterns=!0),"temp"),r=0,s=new T.util.HashTable;null!==i&&(null===a.numIterations||r<a.numIterations);)null!==(i=((t,e,n)=>{for(var a=null,i=0;i<o.length;i++)if(a=o[i],(!1!==n||"fsm"!==a.type)&&function t(e,n,a){var i=n(e,a);if(i)return i;var r=[];e.tag===l.ALT?r=e.choices:e.tag===l.SEQ?r=e.elements:e.tag===l.KSTAR&&(r=[e.expr]);for(var s=0;s<r.length;s++)if(i=t(r[s],n,a))return i;return!1}(t,a.function,e))return a.pattern;return null})(n,s,a.useFsmPatterns))&&null!==a.appliedPatterns&&a.appliedPatterns.push(i),r+=1;return n}},(s={ALT:{},KSTAR:{},LEFT_PAREN:{},RIGHT_PAREN:{},EPS:{}}).ALT.toString=function(){return"+"},s.KSTAR.toString=function(){return"*"},s.LEFT_PAREN.toString=function(){return"("},s.RIGHT_PAREN.toString=function(){return")"},s.EPS.toString=function(){return"$"},x.prototype=new Error,{tree:t,array:{specials:s,toTree:function(t){if(0===t.length)return T.re.tree.makeSeq([]);var e=k(t={arr:t,idx:0,peek:L,advance:R});if(void 0!==t.peek())throw new x("Malformed regex array: successfully parsed up to position "+t.idx,t.idx);return e},toString:function(t){for(var e,n=[],a=!1,i=0;i<t.length;i++){if("string"==typeof(e=t[i])?1!==e.length?a=!0:e=(t=>{for(var e=T.re.string.escapable,n=0;n<e.length;n++)if(t===e[n])return"\\"+t;return t})(e):void 0===(e=(t=>{if(t===s.ALT||t===s.KSTAR||t===s.LEFT_PAREN||t===s.RIGHT_PAREN||t===s.EPS)return t.toString()})(e))&&(a=!0),a)throw new x("Array regex not convertible to string representation: failed at position "+i,i);n.push(e)}return n.join("")},toAutomaton:function(t){return t=T.re.array.toTree(t),T.re.tree.toAutomaton(t)},random:function(t,e,n){return T.re.tree.toArray(T.re.tree.random(t,e,n))},simplify:function(t,e,n){return t=T.re.array.toTree(t),t=T.re.tree.simplify(t,e,n),T.re.tree.toArray(t)}},string:{escapable:u="$+*()\\",toArray:function(t){for(var e,n=[],a=!1,i=T.re.array.specials,r=0;r<t.length;++r)if(a){if(-1===u.indexOf(t[r]))throw new RegexError("Malformed string regex: illegal escape sequence \\"+t[r],r);n.push(t[r]),a=!1}else if("\\"===t[r])a=!0;else{switch(e=t[r]){case"$":e=i.EPS;break;case"+":e=i.ALT;break;case"*":e=i.KSTAR;break;case"(":e=i.LEFT_PAREN;break;case")":e=i.RIGHT_PAREN}n.push(e)}if(a)throw new RegexError("Malformed string regex: unfinished escape sequence at end of string",t.length-1);return n},toTree:function(t){return t=T.re.string.toArray(t),T.re.array.toTree(t)},toAutomaton:function(t){return t=T.re.string.toTree(t),T.re.tree.toAutomaton(t)},random:function(t,e,n){for(var a=[],i=0;i<e.length;i++)a.push(e.charAt(i));return T.re.tree.toString(T.re.tree.random(t,a,n))},simplify:function(t,e,n){return t=T.re.string.toTree(t),t=T.re.tree.simplify(t,e,n),T.re.tree.toString(t)}}}),T})());